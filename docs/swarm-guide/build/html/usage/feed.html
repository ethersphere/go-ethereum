

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Feeds &mdash; Swarm 0.3 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Swarm
          

          
          </a>

          
            
            
              <div class="version">
                0.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">2. Installation and Updates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gettingstarted.html">3. Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../up-and-download.html">4. Uploading and downloading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">5. Working with content</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pss.html">6. PSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apireference.html">7. API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">8. Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../architecture.html">9. Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources.html">10. Resources</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Swarm</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Feeds</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/usage/feed.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="feeds">
<h1>Feeds<a class="headerlink" href="#feeds" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Feeds, previously known as <em>Mutable Resource Updates</em>, is an experimental feature, available since Swarm POC3. It is under active development, so expect things to change.</p>
</div>
<p>Since Swarm hashes are content addressed, changes to data will constantly result in changing hashes. Swarm Feeds provide a way to easily overcome this problem and provide a single, persistent, identifier to follow sequential data.</p>
<p>The usual way of keeping the same pointer to changing data is using the Ethereum Name Service (ENS). However, since ENS is an on-chain feature, it might not be suitable for each use case since:</p>
<ol class="arabic simple">
<li>Every update to an ENS resolver will cost gas to execute</li>
<li>It is not be possible to change the data faster than the rate that new blocks are mined</li>
<li>ENS resolution requires your node to be synced to the blockchain</li>
</ol>
<p>Swarm Feeds provide a way to have a persistent identifier for changing data without having to use ENS. It is named Feeds for its similarity with a news feed.</p>
<p>If you are using <em>Feeds</em> in conjunction with an ENS resolver contract, only one initial transaction to register the “Feed manifest address” will be necessary. This key will resolve to the latest version of the Feed (updating the Feed will not change the key).</p>
<p>You can think of a Feed as a user’s Twitter account, where he/she posts updates about a particular Topic. In fact, the Feed object is simply defined as:</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">type</span> <span class="nx">Feed</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">Topic</span> <span class="nx">Topic</span>
  <span class="nx">User</span>  <span class="nx">common</span><span class="p">.</span><span class="nx">Address</span>
<span class="p">}</span>
</pre></div>
</div>
<p>That is, a specific user posting updates about a specific Topic.</p>
<p>Users can post to any topic. If you know the user’s address and agree on a particular Topic, you can then effectively “follow” that user’s Feed.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p>How you build the Topic is entirely up to your application. You could calculate a hash of something and use that, the recommendation
is that it should be easy to derive out of information that is accesible to other users.</p>
<p class="last">For convenience, <code class="docutils literal notranslate"><span class="pre">feed.NewTopic()</span></code> provides a way to “merge” a byte array with a string in order to build a Feed Topic out of both.
This is used at the API level to create the illusion of subtopics. This way of building topics allows using a random byte array (for example the hash of a photo)
and merge it with a human-readable string such as “comments” in order to create a Topic that could represent the comments about that particular photo.
This way, when you see a picture in a website you could immediately build a Topic out of it and see if some user posted comments about that photo.</p>
</div>
<p>Feeds are not created, only updated. If a particular Feed (user, topic combination) has never posted to, trying to fetch updates will yield nothing.</p>
<div class="section" id="feed-manifests">
<h2>Feed Manifests<a class="headerlink" href="#feed-manifests" title="Permalink to this headline">¶</a></h2>
<p>A Feed Manifest is simply a JSON object that contains the <code class="docutils literal notranslate"><span class="pre">Topic</span></code> and <code class="docutils literal notranslate"><span class="pre">User</span></code> of a particular Feed (i.e., a serialized <code class="docutils literal notranslate"><span class="pre">Feed</span></code> object). Uploading this JSON object to Swarm in the regular way will return the immutable hash of this object. We can then store this immutable hash in an ENS Resolver so that we can have a ENS domain that “follows” the Feed described in the manifest.</p>
</div>
<div class="section" id="feeds-api">
<h2>Feeds API<a class="headerlink" href="#feeds-api" title="Permalink to this headline">¶</a></h2>
<p>There  are 3 different ways of interacting with <em>Feeds</em> : HTTP API, CLI and Golang API.</p>
<div class="section" id="http-api">
<h3>HTTP API<a class="headerlink" href="#http-api" title="Permalink to this headline">¶</a></h3>
<div class="section" id="posting-to-a-feed">
<h4>Posting to a Feed<a class="headerlink" href="#posting-to-a-feed" title="Permalink to this headline">¶</a></h4>
<p>Since Feed updates need to be signed, and an update has some correlation with a previous update, it is necessary to retrieve first the Feed’s current status. Thus, the first step to post an update will be to retrieve this current status in a ready-to-sign template:</p>
<ol class="arabic simple">
<li>Get Feed template</li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/bzz-feed:/?topic=&lt;TOPIC&gt;&amp;user=&lt;USER&gt;&amp;meta=1</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/bzz-feed:/&lt;MANIFEST</span> <span class="pre">OR</span> <span class="pre">ENS</span> <span class="pre">NAME&gt;/?meta=1</span></code></p>
<dl class="docutils">
<dt>Where:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal notranslate"><span class="pre">user</span></code>: Ethereum address of the user who publishes the Feed</li>
<li><code class="docutils literal notranslate"><span class="pre">topic</span></code>: Feed topic, encoded as a hex string. Topic is an arbitrary 32-byte string (64 hex chars)</li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>If <code class="docutils literal notranslate"><span class="pre">topic</span></code> is omitted, it is assumed to be zero, 0x000…</li>
<li>if <code class="docutils literal notranslate"><span class="pre">name=&lt;name&gt;</span></code> (optional) is provided, a subtopic is composed with that name</li>
<li>A common use is to omit topic and just use <code class="docutils literal notranslate"><span class="pre">name</span></code>, allowing for human-readable topics</li>
</ul>
</div>
<p>You will receive a JSON like the below:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;feed&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;topic&quot;</span><span class="o">:</span> <span class="s2">&quot;0x6a61766900000000000000000000000000000000000000000000000000000000&quot;</span><span class="p">,</span>
    <span class="s2">&quot;user&quot;</span><span class="o">:</span> <span class="s2">&quot;0xdfa2db618eacbfe84e94a71dda2492240993c45b&quot;</span>
  <span class="p">},</span>
  <span class="s2">&quot;epoch&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;level&quot;</span><span class="o">:</span> <span class="mi">16</span><span class="p">,</span>
    <span class="s2">&quot;time&quot;</span><span class="o">:</span> <span class="mi">1534237239</span>
  <span class="p">}</span>
  <span class="s2">&quot;protocolVersion&quot;</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Post the update</li>
</ol>
<p>Extract the fields out of the JSON and build a query string as below:</p>
<p><code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/bzz-feed:/?topic=&lt;TOPIC&gt;&amp;user=&lt;USER&gt;&amp;level=&lt;LEVEL&gt;&amp;time=&lt;TIME&gt;&amp;signature=&lt;SIGNATURE&gt;</span></code></p>
<dl class="docutils">
<dt>Where:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal notranslate"><span class="pre">topic</span></code>: Feed topic, as specified above</li>
<li><code class="docutils literal notranslate"><span class="pre">user</span></code>: your Ethereum address</li>
<li><code class="docutils literal notranslate"><span class="pre">level</span></code>: Suggested frequency level retrieved in the JSON above</li>
<li><code class="docutils literal notranslate"><span class="pre">time</span></code>: Suggested timestamp retrieved in the JSON above</li>
<li><code class="docutils literal notranslate"><span class="pre">protocolVersion</span></code>: Feeds protocol version. Currently <code class="docutils literal notranslate"><span class="pre">0</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">signature</span></code>: Signature, hex encoded. See below on how to calclulate the signature</li>
<li>Request posted data: binary stream with the update data</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="reading-a-feed">
<h4>Reading a Feed<a class="headerlink" href="#reading-a-feed" title="Permalink to this headline">¶</a></h4>
<p>To retrieve a Feed’s last update:</p>
<p><code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/bzz-feed:/?topic=&lt;TOPIC&gt;&amp;user=&lt;USER&gt;</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/bzz-feed:/&lt;MANIFEST</span> <span class="pre">OR</span> <span class="pre">ENS</span> <span class="pre">NAME&gt;</span></code></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Again, if <code class="docutils literal notranslate"><span class="pre">topic</span></code> is omitted, it is assumed to be zero, 0x000…</li>
<li>If <code class="docutils literal notranslate"><span class="pre">name=&lt;name&gt;</span></code> is provided, a subtopic is composed with that name</li>
<li>A common use is to omit <code class="docutils literal notranslate"><span class="pre">topic</span></code> and just use <code class="docutils literal notranslate"><span class="pre">name</span></code>, allowing for human-readable topics, for example:
<code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/bzz-feed:/?name=profile-picture&amp;user=&lt;USER&gt;</span></code></li>
</ul>
</div>
<p>To get a previous update:</p>
<p>Add an addtional <code class="docutils literal notranslate"><span class="pre">time</span></code> parameter. The last update before that <code class="docutils literal notranslate"><span class="pre">time</span></code> (unix time) will be looked up.</p>
<p><code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/bzz-feed:/?topic=&lt;TOPIC&gt;&amp;user=&lt;USER&gt;&amp;time=&lt;T&gt;</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/bzz-feed:/&lt;MANIFEST</span> <span class="pre">OR</span> <span class="pre">ENS</span> <span class="pre">NAME&gt;?time=&lt;T&gt;</span></code></p>
</div>
<div class="section" id="creating-a-feed-manifest">
<h4>Creating a Feed Manifest<a class="headerlink" href="#creating-a-feed-manifest" title="Permalink to this headline">¶</a></h4>
<p>To create a <code class="docutils literal notranslate"><span class="pre">Feed</span> <span class="pre">manifest</span></code> using the HTTP API:</p>
<p><code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/bzz-feed:/?topic=&lt;TOPIC&gt;&amp;user=&lt;USER&gt;&amp;manifest=1.</span></code> With an empty body.</p>
<p>This will create a manifest referencing the provided Feed.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This API call will be deprecated in the near future.</p>
</div>
</div>
</div>
<div class="section" id="go-api">
<h3>Go API<a class="headerlink" href="#go-api" title="Permalink to this headline">¶</a></h3>
<div class="section" id="query-object">
<h4>Query object<a class="headerlink" href="#query-object" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">Query</span></code> object allows you to build a query to browse a particular <code class="docutils literal notranslate"><span class="pre">Feed</span></code>.</p>
<p>The default <code class="docutils literal notranslate"><span class="pre">Query</span></code>, obtained with <code class="docutils literal notranslate"><span class="pre">feed.NewQueryLatest()</span></code> will build a <code class="docutils literal notranslate"><span class="pre">Query</span></code> that retrieves the latest update of the given <code class="docutils literal notranslate"><span class="pre">Feed</span></code>.</p>
<p>You can also use <code class="docutils literal notranslate"><span class="pre">feed.NewQuery()</span></code> instead, if you want to build a <code class="docutils literal notranslate"><span class="pre">Query</span></code> to look up an update before a certain date.</p>
<p>Advanced usage of <code class="docutils literal notranslate"><span class="pre">Query</span></code> includes hinting the lookup algorithm for faster lookups. The default hint <code class="docutils literal notranslate"><span class="pre">lookup.NoClue</span></code> will have your node track Feeds you query frequently and handle hints automatically.</p>
</div>
<div class="section" id="request-object">
<h4>Request object<a class="headerlink" href="#request-object" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">Request</span></code> object makes it easy to construct and sign a request to Swarm to update a particular Feed. It contains methods to sign and add data. We can  manually build the <code class="docutils literal notranslate"><span class="pre">Request</span></code> object, or fetch a valid “template” to use for the update.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">Request</span></code> can also be serialized to JSON in case you need your application to delegate signatures, such as having a browser sign a Feed update request.</p>
</div>
<div class="section" id="id1">
<h4>Posting to a Feed<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>Retrieve a <code class="docutils literal notranslate"><span class="pre">Request</span></code> object or build one from scratch. To retrieve a ready-to-sign one:</li>
</ol>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Client</span><span class="p">)</span> <span class="nx">GetFeedRequest</span><span class="p">(</span><span class="nx">query</span> <span class="o">*</span><span class="nx">feed</span><span class="p">.</span><span class="nx">Query</span><span class="p">,</span> <span class="nx">manifestAddressOrDomain</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">feed</span><span class="p">.</span><span class="nx">Request</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Use <code class="docutils literal notranslate"><span class="pre">Request.SetData()</span></code> and <code class="docutils literal notranslate"><span class="pre">Request.Sign()</span></code> to load the payload data into the request and sign it</li>
<li>Call <code class="docutils literal notranslate"><span class="pre">UpdateFeed()</span></code> with the filled <code class="docutils literal notranslate"><span class="pre">Request</span></code>:</li>
</ol>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Client</span><span class="p">)</span> <span class="nx">UpdateFeed</span><span class="p">(</span><span class="nx">request</span> <span class="o">*</span><span class="nx">feed</span><span class="p">.</span><span class="nx">Request</span><span class="p">,</span> <span class="nx">createManifest</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">(</span><span class="nx">io</span><span class="p">.</span><span class="nx">ReadCloser</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h4>Reading a Feed<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>To retrieve a Feed update, use <cite>client.QueryFeed()</cite>. <code class="docutils literal notranslate"><span class="pre">QueryFeed</span></code> returns a byte stream with the raw content of the Feed update.</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Client</span><span class="p">)</span> <span class="nx">QueryFeed</span><span class="p">(</span><span class="nx">query</span> <span class="o">*</span><span class="nx">feed</span><span class="p">.</span><span class="nx">Query</span><span class="p">,</span> <span class="nx">manifestAddressOrDomain</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">io</span><span class="p">.</span><span class="nx">ReadCloser</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">manifestAddressOrDomain</span></code> is the address you obtained in <code class="docutils literal notranslate"><span class="pre">CreateFeedWithManifest</span></code> or an <code class="docutils literal notranslate"><span class="pre">ENS</span></code> domain whose Resolver
points to that address.
<code class="docutils literal notranslate"><span class="pre">query</span></code> is a Query object, as defined above.</p>
<p>You only need to provide either <code class="docutils literal notranslate"><span class="pre">manifestAddressOrDomain</span></code> or <code class="docutils literal notranslate"><span class="pre">Query</span></code> to <code class="docutils literal notranslate"><span class="pre">QueryFeed()</span></code>. Set to <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">nil</span></code> respectively.</p>
</div>
<div class="section" id="id3">
<h4>Creating a Feed Manifest<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>Swarm client (package swarm/api/client) has the following method:</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">Client</span><span class="p">)</span> <span class="nx">CreateFeedWithManifest</span><span class="p">(</span><span class="nx">request</span> <span class="o">*</span><span class="nx">feed</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">CreateFeedWithManifest</span></code> uses the <code class="docutils literal notranslate"><span class="pre">request</span></code> parameter to set and create a  <code class="docutils literal notranslate"><span class="pre">Feed</span> <span class="pre">manifest</span></code>.</p>
<p>Returns the resulting <code class="docutils literal notranslate"><span class="pre">Feed</span> <span class="pre">manifest</span> <span class="pre">address</span></code> that you can set in an ENS Resolver (setContent) or reference future updates using <code class="docutils literal notranslate"><span class="pre">Client.UpdateFeed()</span></code></p>
</div>
<div class="section" id="example-go-code">
<h4>Example Go code<a class="headerlink" href="#example-go-code" title="Permalink to this headline">¶</a></h4>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="c1">// Build a `Feed` object to track a particular user&#39;s updates</span>
<span class="nx">f</span> <span class="o">:=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">feed</span><span class="p">.</span><span class="nx">Feed</span><span class="p">)</span>
<span class="nx">f</span><span class="p">.</span><span class="nx">User</span> <span class="p">=</span> <span class="nx">signer</span><span class="p">.</span><span class="nx">Address</span><span class="p">()</span>
<span class="nx">f</span><span class="p">.</span><span class="nx">Topic</span><span class="p">,</span> <span class="nx">_</span> <span class="p">=</span> <span class="nx">feed</span><span class="p">.</span><span class="nx">NewTopic</span><span class="p">(</span><span class="s">&quot;weather&quot;</span><span class="p">,</span><span class="kc">nil</span><span class="p">)</span>

<span class="c1">// Build a `Query` to retrieve a current Request for this feed</span>
<span class="nx">query</span> <span class="o">:=</span> <span class="nx">feeds</span><span class="p">.</span><span class="nx">NewQueryLatest</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">f</span><span class="p">,</span> <span class="nx">lookup</span><span class="p">.</span><span class="nx">NoClue</span><span class="p">)</span>

<span class="c1">// Retrieve a ready-to-sign request using our query</span>
<span class="c1">// (queries can be reused)</span>
<span class="nx">request</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">GetFeedRequest</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="nx">utils</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;Error retrieving feed status: %s&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">())</span>
<span class="p">}</span>

<span class="c1">// set the new data</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">SetData</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&quot;Weather looks bright and sunny today, we should merge this PR and go out enjoy&quot;</span><span class="p">))</span>

<span class="c1">// sign update</span>
<span class="k">if</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">Sign</span><span class="p">(</span><span class="nx">signer</span><span class="p">);</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="nx">utils</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;Error signing feed update: %s&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">())</span>
<span class="p">}</span>

<span class="c1">// post update</span>
<span class="nx">err</span> <span class="p">=</span> <span class="nx">client</span><span class="p">.</span><span class="nx">UpdateFeed</span><span class="p">(</span><span class="nx">request</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="nx">utils</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;Error updating feed: %s&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">())</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="command-line">
<h3>Command-Line<a class="headerlink" href="#command-line" title="Permalink to this headline">¶</a></h3>
<p>The CLI API allows us to go through how Feeds work using practical examples. You can look up CL usage by typing <code class="docutils literal notranslate"><span class="pre">swarm</span> <span class="pre">feed</span></code> into your CLI.</p>
<p>In the CLI examples, we will create and update feeds using the bzzapi on a running local Swarm node that listens by default on port 8500.</p>
<div class="section" id="id4">
<h4>Creating a Feed Manifest<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>The Swarm CLI allows creating Feed Manifests directly from the console.</p>
<p><code class="docutils literal notranslate"><span class="pre">swarm</span> <span class="pre">feed</span> <span class="pre">create</span></code> is defined as a command to create and publish a <code class="docutils literal notranslate"><span class="pre">Feed</span> <span class="pre">manifest</span></code>.</p>
<dl class="docutils">
<dt>The feed topic can be built in the following ways:</dt>
<dd><ul class="first last simple">
<li>use <code class="docutils literal notranslate"><span class="pre">--topic</span></code> to set the topic to an arbitrary binary hex string.</li>
<li><dl class="first docutils">
<dt>use <code class="docutils literal notranslate"><span class="pre">--name</span></code> to set the topic to a human-readable name.</dt>
<dd>For example, <code class="docutils literal notranslate"><span class="pre">--name</span></code> could be set to “profile-picture”, meaning this feed allows to get this user’s current profile picture.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>use both <code class="docutils literal notranslate"><span class="pre">--topic</span></code> and <code class="docutils literal notranslate"><span class="pre">--name</span></code> to create named subtopics.</dt>
<dd>For example, <cite>–topic</cite> could be set to an Ethereum contract address and <code class="docutils literal notranslate"><span class="pre">--name</span></code> could be set to “comments”, meaning this feed tracks a discussion about that contract.</dd>
</dl>
</li>
</ul>
</dd>
</dl>
<p>The <code class="docutils literal notranslate"><span class="pre">--user</span></code> flag allows to have this manifest refer to a user other than yourself. If not specified, it will then default to your local account (<code class="docutils literal notranslate"><span class="pre">--bzzaccount</span></code>).</p>
<p>If you don’t specify a name or a topic, the topic will be set to <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">hex</span></code> and name will be set to your username.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ swarm --bzzapi http://localhost:8500 feed create --name test
</pre></div>
</div>
<p>creates a feed named “test”. This is equivalent to the HTTP API way of</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ swarm --bzzapi http://localhost:8500 feed create --topic 0x74657374
</pre></div>
</div>
<p>since <code class="docutils literal notranslate"><span class="pre">test</span> <span class="pre">string</span> <span class="pre">==</span> <span class="pre">0x74657374</span> <span class="pre">hex</span></code>. Name and topic are interchangeable, as long as you don’t specify both.</p>
<p><code class="docutils literal notranslate"><span class="pre">feed</span> <span class="pre">create</span></code> will return the <strong>feed manifest</strong>.</p>
<p>You can also use <code class="docutils literal notranslate"><span class="pre">curl</span></code> in the HTTP API, but, here, you have to explicitly define the user (which, in this case, is your account) and the manifest.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ curl -XPOST -d &#39;name=test&amp;user=&lt;your account&gt;&amp;manifest=1&#39; http://localhost:8500/bzz-Feed:/
</pre></div>
</div>
<p>is equivalent to</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ curl -XPOST -d &#39;topic=0x74657374&amp;user=&lt;your account&gt;&amp;manifest=1&#39; http://localhost:8500/bzz-Feed:/
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h4>Posting to a Feed<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p>To update a Feed with the CLI, use <code class="docutils literal notranslate"><span class="pre">feed</span> <span class="pre">update</span></code>. The <strong>update</strong> argument has to be in <code class="docutils literal notranslate"><span class="pre">hex</span></code>. If you want to update your <em>test</em> feed with the update <em>hello</em>, you can refer to it by name:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ swarm --bzzapi http://localhost:8500 feed update --name test 0x68656c6c6f203
</pre></div>
</div>
<p>You can also refer to it by topic,</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ swarm --bzzapi http://localhost:8500 feed update --topic 0x74657374 0x68656c6c6f203
</pre></div>
</div>
<p>or manifest.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ swarm --bzzapi http://localhost:8500 feed update --manifest &lt;manifest hash&gt; 0x68656c6c6f203
</pre></div>
</div>
</div>
<div class="section" id="reading-feed-status">
<h4>Reading Feed status<a class="headerlink" href="#reading-feed-status" title="Permalink to this headline">¶</a></h4>
<p>You can read the feed object using <code class="docutils literal notranslate"><span class="pre">feed</span> <span class="pre">info</span></code>. Again, you can use the feed name, the topic, or the manifest hash. Below, we use the name.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ swarm --bzzapi http://localhost:8500 feed info --name test
</pre></div>
</div>
</div>
<div class="section" id="reading-feed-updates">
<h4>Reading Feed Updates<a class="headerlink" href="#reading-feed-updates" title="Permalink to this headline">¶</a></h4>
<p>Although the Swarm CLI doesn’t have the functionality to retrieve feed updates, we can use <code class="docutils literal notranslate"><span class="pre">curl</span></code> and the HTTP api to retrieve them. Again, you can use the feed name, topic, or manifest hash. To return the update <code class="docutils literal notranslate"><span class="pre">hello</span></code> for your <code class="docutils literal notranslate"><span class="pre">test</span></code> feed, do this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ curl &#39;http://localhost:8500/bzz-feed:/?user=&lt;your address&gt;&amp;name=test&#39;
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="computing-feed-signatures">
<h2>Computing Feed Signatures<a class="headerlink" href="#computing-feed-signatures" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>computing the digest:</li>
</ol>
<dl class="docutils">
<dt>The digest is computed concatenating the following:</dt>
<dd><ul class="first last simple">
<li>1-byte protocol version (currently 0)</li>
<li>7-bytes padding, set to 0</li>
<li>32-bytes topic</li>
<li>20-bytes user address</li>
<li>7-bytes time, little endian</li>
<li>1-byte level</li>
<li>payload data (variable length)</li>
</ul>
</dd>
</dl>
<ol class="arabic simple" start="2">
<li>Take the SHA3 hash of the above digest</li>
<li>Compute the ECDSA signature of the hash</li>
<li>Convert to hex string and put in the <code class="docutils literal notranslate"><span class="pre">signature</span></code> field above</li>
</ol>
<div class="section" id="javascript-example">
<h3>JavaScript example<a class="headerlink" href="#javascript-example" title="Permalink to this headline">¶</a></h3>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">web3</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;web3&quot;</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">module</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">digest</span><span class="o">:</span> <span class="nx">feedUpdateDigest</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">topicLength</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">userLength</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">timeLength</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">levelLength</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">headerLength</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">updateMinLength</span> <span class="o">=</span> <span class="nx">topicLength</span> <span class="o">+</span> <span class="nx">userLength</span> <span class="o">+</span> <span class="nx">timeLength</span> <span class="o">+</span> <span class="nx">levelLength</span> <span class="o">+</span> <span class="nx">headerLength</span><span class="p">;</span>




<span class="kd">function</span> <span class="nx">feedUpdateDigest</span><span class="p">(</span><span class="nx">request</span> <span class="cm">/*request*/</span><span class="p">,</span> <span class="nx">data</span> <span class="cm">/*UInt8Array*/</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">topicBytes</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">userBytes</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">protocolVersion</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="nx">protocolVersion</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">protocolVersion</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="nx">topicBytes</span> <span class="o">=</span> <span class="nx">web3</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">hexToBytes</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">feed</span><span class="p">.</span><span class="nx">topic</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;topicBytes: &quot;</span> <span class="o">+</span> <span class="nx">err</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="nx">userBytes</span> <span class="o">=</span> <span class="nx">web3</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">hexToBytes</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">feed</span><span class="p">.</span><span class="nx">user</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;topicBytes: &quot;</span> <span class="o">+</span> <span class="nx">err</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">undefined</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">buf</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayBuffer</span><span class="p">(</span><span class="nx">updateMinLength</span> <span class="o">+</span> <span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DataView</span><span class="p">(</span><span class="nx">buf</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">cursor</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="nx">view</span><span class="p">.</span><span class="nx">setUint8</span><span class="p">(</span><span class="nx">cursor</span><span class="p">,</span> <span class="nx">protocolVersion</span><span class="p">)</span> <span class="c1">// first byte is protocol version.</span>
    <span class="nx">cursor</span><span class="o">+=</span><span class="nx">headerLength</span><span class="p">;</span> <span class="c1">// leave the next 7 bytes (padding) set to zero</span>

  <span class="nx">topicBytes</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">view</span><span class="p">.</span><span class="nx">setUint8</span><span class="p">(</span><span class="nx">cursor</span><span class="p">,</span> <span class="nx">v</span><span class="p">);</span>
    <span class="nx">cursor</span><span class="o">++</span><span class="p">;</span>
  <span class="p">});</span>

  <span class="nx">userBytes</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">view</span><span class="p">.</span><span class="nx">setUint8</span><span class="p">(</span><span class="nx">cursor</span><span class="p">,</span> <span class="nx">v</span><span class="p">);</span>
    <span class="nx">cursor</span><span class="o">++</span><span class="p">;</span>
  <span class="p">});</span>

  <span class="c1">// time is little-endian</span>
  <span class="nx">view</span><span class="p">.</span><span class="nx">setUint32</span><span class="p">(</span><span class="nx">cursor</span><span class="p">,</span> <span class="nx">request</span><span class="p">.</span><span class="nx">epoch</span><span class="p">.</span><span class="nx">time</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
  <span class="nx">cursor</span> <span class="o">+=</span> <span class="mi">7</span><span class="p">;</span>

  <span class="nx">view</span><span class="p">.</span><span class="nx">setUint8</span><span class="p">(</span><span class="nx">cursor</span><span class="p">,</span> <span class="nx">request</span><span class="p">.</span><span class="nx">epoch</span><span class="p">.</span><span class="nx">level</span><span class="p">);</span>
  <span class="nx">cursor</span><span class="o">++</span><span class="p">;</span>

  <span class="nx">data</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">view</span><span class="p">.</span><span class="nx">setUint8</span><span class="p">(</span><span class="nx">cursor</span><span class="p">,</span> <span class="nx">v</span><span class="p">);</span>
    <span class="nx">cursor</span><span class="o">++</span><span class="p">;</span>
    <span class="p">});</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">web3</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">bytesToHex</span><span class="p">(</span><span class="k">new</span> <span class="nx">Uint8Array</span><span class="p">(</span><span class="nx">buf</span><span class="p">)))</span>

  <span class="k">return</span> <span class="nx">web3</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">sha3</span><span class="p">(</span><span class="nx">web3</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">bytesToHex</span><span class="p">(</span><span class="k">new</span> <span class="nx">Uint8Array</span><span class="p">(</span><span class="nx">buf</span><span class="p">)));</span>
<span class="p">}</span>

<span class="c1">// data payload</span>
<span class="nx">data</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Uint8Array</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span><span class="mi">154</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">165</span><span class="p">,</span><span class="mi">62</span><span class="p">])</span>

<span class="c1">// request template, obtained calling http://localhost:8500/bzz-feed:/?user=&lt;0xUSER&gt;&amp;topic=&lt;0xTOPIC&gt;&amp;meta=1</span>
<span class="nx">request</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;feed&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;topic&quot;</span><span class="o">:</span><span class="s2">&quot;0x1234123412341234123412341234123412341234123412341234123412341234&quot;</span><span class="p">,</span><span class="s2">&quot;user&quot;</span><span class="o">:</span><span class="s2">&quot;0xabcdefabcdefabcdefabcdefabcdefabcdefabcd&quot;</span><span class="p">},</span><span class="s2">&quot;epoch&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="o">:</span><span class="mi">1538650124</span><span class="p">,</span><span class="s2">&quot;level&quot;</span><span class="o">:</span><span class="mi">25</span><span class="p">},</span><span class="s2">&quot;protocolVersion&quot;</span><span class="o">:</span><span class="mi">0</span><span class="p">}</span>

<span class="c1">// obtain digest</span>
<span class="nx">digest</span> <span class="o">=</span> <span class="nx">feedUpdateDigest</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">digest</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Ethersphere

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>